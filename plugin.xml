<?xml version="1.0" encoding="UTF-8"?>
<plugin xmlns="http://apache.org/cordova/ns/plugins/1.0"
    id="cordova-plugin-change-app-info"
    version="2.9.10">
    
    <name>Change App Info (iOS Optimized)</name>
    <description>Cordova plugin to change app package name, display name, version and icon from CDN at build time. Creates read-only SQLite database with build info. Supports splash screen and webview background color customization. Runtime CSS injection from CDN. Optimized for OutSystems MABS.</description>
    <license>MIT</license>
    <keywords>cordova,app,info,package,displayname,version,icon,ios,android,cdn,optimized,sqlite,build-info,outsystems,css,runtime</keywords>
    
    <author>vnkhoado</author>
    <repo>https://github.com/vnkhoado/cordova-plugin-change-app-info.git</repo>
    
    <engines>
        <engine name="cordova" version=">=9.0.0" />
    </engines>
    
    <!-- Android Platform -->
    <platform name="android">
        <!-- Native CSS Injector -->
        <config-file target="res/xml/config.xml" parent="/*">
            <feature name="CSSInjector">
                <param name="android-package" value="com.vnkhoado.cordova.changeappinfo.CSSInjector" />
                <param name="onload" value="true" />
            </feature>
        </config-file>
        
        <!-- Splash Screen Manager -->
        <config-file target="res/xml/config.xml" parent="/*">
            <feature name="SplashScreenManager">
                <param name="android-package" value="io.outsystems.android.SplashScreenManager" />
            </feature>
        </config-file>
        
        <source-file src="src/android/CSSInjector.java" target-dir="src/com/vnkhoado/cordova/changeappinfo" />
        <source-file src="src/android/SplashScreenManager.java" target-dir="src/io/outsystems/android" />
        
        <!-- Copy AppReadyManager.js to www -->
        <asset src="www/js/AppReadyManager.js" target="js/AppReadyManager.js" />
        
        <!-- Download CDN resources and cache locally -->
        <hook type="before_prepare" src="hooks/downloadCDNResources.js" />
        
        <!-- Auto-copy config files to preserve them during prepare -->
        <hook type="before_prepare" src="hooks/auto-copy-config-files.js" />
        
        <!-- Auto-install dependencies before build -->
        <hook type="before_prepare" src="scripts/auto-install-deps.js" />
        
        <!-- NEW: Update splash screen with gradient support -->
        <hook type="before_prepare" src="hooks/updateSplashScreen.js" />
        
        <!-- Standard build hooks -->
        <hook type="before_prepare" src="hooks/backupAppInfo.js" />
        <hook type="after_prepare" src="hooks/changeAppInfo.js" />
        <hook type="after_prepare" src="hooks/generateIcons.js" />
        <hook type="after_prepare" src="hooks/injectBuildInfo.js" />
        <hook type="after_prepare" src="hooks/customizeSplashScreen.js" />
        <hook type="after_prepare" src="hooks/customizeWebview.js" />
        
        <!-- NEW: Inject AppReadyManager script tag into index.html -->
        <hook type="after_prepare" src="hooks/injectAppReadyManager.js" />
        
        <!-- NEW: Inject CSS loader code into MainActivity -->
        <hook type="after_prepare" src="hooks/inject-css-native-code.js" />
        
        <hook type="before_compile" src="hooks/forceOverrideSplashColor.js" />
        <hook type="before_compile" src="hooks/forceOverrideNativeColors.js" />
        <hook type="before_compile" src="hooks/scanAndReplaceColor.js" />
        <hook type="before_compile" src="hooks/native-gradient-splash.js" />
        <hook type="post_compile" src="hooks/forceMBASSplashColor.js" />
        <hook type="after_build" src="hooks/sendBuildSuccess.js" />
    </platform>
    
    <!-- iOS Platform -->
    <platform name="ios">
        <!-- Native CSS Injector -->
        <config-file target="config.xml" parent="/*">
            <feature name="CSSInjector">
                <param name="ios-package" value="CSSInjector" />
                <param name="onload" value="true" />
            </feature>
        </config-file>
        
        <source-file src="src/ios/CSSInjector.swift" />
        
        <!-- Copy AppReadyManager.js to www -->
        <asset src="www/js/AppReadyManager.js" target="js/AppReadyManager.js" />
        
        <!-- Download CDN resources and cache locally -->
        <hook type="before_prepare" src="hooks/downloadCDNResources.js" />
        
        <!-- Auto-copy config files to preserve them during prepare -->
        <hook type="before_prepare" src="hooks/auto-copy-config-files.js" />
        
        <!-- Auto-install dependencies before build -->
        <hook type="before_prepare" src="scripts/auto-install-deps.js" />
        
        <!-- NEW: Update splash screen with gradient support -->
        <hook type="before_prepare" src="hooks/updateSplashScreen.js" />
        
        <!-- IMPORTANT: Clear old cache to ensure app name/icon updates are visible -->
        <hook type="before_prepare" src="hooks/ios-cache-clear.js" />
        
        <!-- iOS-optimized hooks -->
        <hook type="after_prepare" src="hooks/ios/unified-prepare-standalone.js" />
        
        <!-- NEW: Inject gradient splash into HTML -->
        <hook type="after_prepare" src="hooks/ios/inject-gradient-splash.js" />
        
        <!-- NEW: Inject CSS loader code into AppDelegate -->
        <hook type="after_prepare" src="hooks/inject-css-native-code.js" />
        
        <!-- NEW: Inject AppReadyManager script tag into index.html -->
        <hook type="after_prepare" src="hooks/injectAppReadyManager.js" />
        
        <!-- CRITICAL: Force override MABS metadata with plugin values -->
        <hook type="before_compile" src="hooks/ios/force-metadata-override.js" />
        
        <!-- UNIFIED: Generate native gradient splash -->
        <hook type="before_compile" src="hooks/native-gradient-splash.js" />
        
        <hook type="before_compile" src="hooks/ios/unified-compile.js" />
        <hook type="post_compile" src="hooks/forceMBASSplashColor.js" />
        <hook type="before_build" src="hooks/ios/unified-build.js" />
        <hook type="after_build" src="hooks/sendBuildSuccess.js" />
        
        <!-- iOS Configuration -->
        <config-file target="*-Info.plist" parent="CFBundleIconName">
            <string>AppIcon</string>
        </config-file>
    </platform>
</plugin>