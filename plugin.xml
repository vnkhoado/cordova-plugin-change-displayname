<?xml version="1.0" encoding="UTF-8"?>
<plugin xmlns="http://apache.org/cordova/ns/plugins/1.0"
    id="cordova-plugin-change-app-info"
    version="2.9.0">
    
    <name>Change App Info</name>
    <description>Cordova plugin to change app package name, display name, version and icon from CDN at build time. Creates pre-built READ-ONLY SQLite database with build info during build. Supports splash screen and webview background color customization with auto-override for OutSystems. Optimized for OutSystems MABS.</description>
    <license>MIT</license>
    <keywords>cordova,app,info,package,displayname,version,icon,ios,android,cdn,outsystems,mabs,sqlite,readonly,webview,background,splash,splashscreen</keywords>
    
    <author>vnkhoado</author>
    <repo>https://github.com/vnkhoado/cordova-plugin-change-app-info.git</repo>
    
    <engines>
        <engine name="cordova" version=">=9.0.0" />
    </engines>
    
    <!-- Dependency: SQLite Storage Plugin -->
    <dependency id="cordova-sqlite-storage" version="^6.1.0" />
    
    <!-- Configuration Preferences:
         
         App Configuration:
         - APP_NAME: App display name (e.g., "MyApp")
         - VERSION_NUMBER: Version string (e.g., "1.0.0")
         - VERSION_CODE: Build number (e.g., "1")
         - CDN_ICON: Icon URL (e.g., https://cdn.com/icon-1024.png)
         
         Runtime Configuration (stored in READ-ONLY SQLite database):
         - API_HOSTNAME: API hostname (e.g., "api.myapp.com") - Auto-injected by OutSystems
         - ENVIRONMENT: Environment name (e.g., "development", "staging", "production")
         
         UI Customization:
         - SplashScreenBackgroundColor: Native splash background (e.g., "#001833") - AUTO-OVERRIDE OutSystems theme
         - WEBVIEW_BACKGROUND_COLOR: Pre-render webview background (e.g., "#001833")
         - OLD_COLOR: (Optional) Old color to scan and replace (e.g., "#59ABE3")
         
         Additional Splash Preferences (optional):
         - SplashScreenDelay: Splash duration in ms (e.g., "3000")
         - FadeSplashScreen: Enable fade effect ("true" or "false")
         - FadeSplashScreenDuration: Fade duration in ms (e.g., "300")
         - AutoHideSplashScreen: Auto hide splash ("true" or "false")
         
         Build Notification (Optional):
         - ENABLE_BUILD_NOTIFICATION: Enable/disable build notification ("true" or "false")
         - BUILD_SUCCESS_API_URL: API endpoint to send build success notification
         - BUILD_API_BEARER_TOKEN: Bearer token for API authentication
    -->
    
    <!-- Android Platform -->
    <platform name="android">
        <!-- Backup app info before changes -->
        <hook type="before_prepare" src="hooks/backupAppInfo.js" />
        
        <!-- Change app info (package, name, version) -->
        <hook type="after_prepare" src="hooks/changeAppInfo.js" />
        
        <!-- Generate icons from CDN -->
        <hook type="after_prepare" src="hooks/generateIcons.js" />
        
        <!-- Create READ-ONLY SQLite database with build info -->
        <hook type="after_prepare" src="hooks/injectBuildInfo.js" />
        
        <!-- Customize splash screen (auto-override OutSystems theme) -->
        <hook type="after_prepare" src="hooks/customizeSplashScreen.js" />
        
        <!-- Customize webview background color -->
        <hook type="after_prepare" src="hooks/customizeWebview.js" />
        
        <!-- FORCE OVERRIDE: Prevent OutSystems from overriding splash colors -->
        <hook type="before_compile" src="hooks/forceOverrideSplashColor.js" />
        
        <!-- NATIVE OVERRIDE: Override pre-splash native colors -->
        <hook type="before_compile" src="hooks/forceOverrideNativeColors.js" />
        
        <!-- SCAN & REPLACE: Find and replace cached old colors -->
        <hook type="before_compile" src="hooks/scanAndReplaceColor.js" />
        
        <!-- Send build success notification to API (if enabled) -->
        <hook type="after_build" src="hooks/sendBuildSuccess.js" />
    </platform>
    
    <!-- iOS Platform -->
    <platform name="ios">
        <!-- Backup app info before changes -->
        <hook type="before_prepare" src="hooks/backupAppInfo.js" />
        
        <!-- Change app info (bundle id, name, version) -->
        <hook type="after_prepare" src="hooks/changeAppInfo.js" />
        
        <!-- Generate icons from CDN -->
        <hook type="after_prepare" src="hooks/generateIcons.js" />
        
        <!-- Create READ-ONLY SQLite database with build info -->
        <hook type="after_prepare" src="hooks/injectBuildInfo.js" />
        
        <!-- Customize splash screen (auto-override OutSystems theme) -->
        <hook type="after_prepare" src="hooks/customizeSplashScreen.js" />
        
        <!-- Customize webview background color -->
        <hook type="after_prepare" src="hooks/customizeWebview.js" />
        
        <!-- FORCE OVERRIDE: Prevent OutSystems from overriding splash colors -->
        <hook type="before_compile" src="hooks/forceOverrideSplashColor.js" />
        
        <!-- NATIVE OVERRIDE: Override pre-splash native colors (iOS MainViewController) -->
        <hook type="before_compile" src="hooks/forceOverrideNativeColors.js" />
        
        <!-- SCAN & REPLACE: Find and replace cached old colors -->
        <hook type="before_compile" src="hooks/scanAndReplaceColor.js" />
        
        <!-- Clean build before compile -->
        <hook type="before_build" src="hooks/cleanBuild.js" />
        
        <!-- Replace iOS Icon after compile -->
        <hook type="after_prepare" src="hooks/forceReplaceIosIcons.js" />
        
        <!-- Send build success notification to API (if enabled) -->
        <hook type="after_build" src="hooks/sendBuildSuccess.js" />
        
        <!-- Force Xcode to use AppIcon from xcassets -->
        <config-file target="*-Info.plist" parent="CFBundleIcons">
            <dict>
                <key>CFBundlePrimaryIcon</key>
                <dict>
                    <key>CFBundleIconFiles</key>
                    <array/>
                    <key>UIPrerenderedIcon</key>
                    <false/>
                </dict>
            </dict>
        </config-file>
        
        <!-- Set AppIcon name -->
        <config-file target="*-Info.plist" parent="CFBundleIconName">
            <string>AppIcon</string>
        </config-file>
    </platform>
</plugin>