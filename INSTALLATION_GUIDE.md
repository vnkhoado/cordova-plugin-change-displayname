# Installation Guide

## Quick Start

### Local Development

```bash
# 1. Install optional dependencies (recommended)
npm install sharp jimp

# 2. Add plugin
cordova plugin add https://github.com/vnkhoado/cordova-plugin-change-app-info.git

# 3. Build
cordova build ios android
```

### For MABS/OutSystems Cloud Build

#### Step 1: Create `package.json` at Project Root

Create file at same level as `config.xml`:

```json
{
  "name": "cordova-app-with-plugin",
  "version": "1.0.0",
  "description": "Cordova app with change-app-info plugin",
  "main": "index.js",
  "scripts": {
    "setup": "npm install",
    "build:ios": "cordova build ios"
  },
  "keywords": ["cordova", "app"],
  "author": "",
  "license": "MIT",
  "dependencies": {
    "sharp": "^0.33.0"
  },
  "optionalDependencies": {
    "jimp": "^0.22.0"
  },
  "engines": {
    "node": ">=14.0.0",
    "npm": ">=6.0.0"
  }
}
```

#### Step 2: Update `config.xml`

Add plugin:

```xml
<?xml version='1.0' encoding='utf-8'?>
<widget id="com.example.app" version="1.0.0" xmlns="http://www.w3.org/ns/widgets">
    
    <name>Your App Name</name>
    <description>Your App Description</description>
    
    <!-- Plugin from GitHub -->
    <plugin name="cordova-plugin-change-app-info" spec="https://github.com/vnkhoado/cordova-plugin-change-app-info.git" />
    
    <!-- Required preferences -->
    <preference name="APP_NAME" value="Your App Name" />
    <preference name="VERSION_NUMBER" value="1.0.0" />
    <preference name="VERSION_CODE" value="1" />
    <preference name="CDN_ICON" value="https://cdn.example.com/icon-1024.png" />
    <preference name="SplashScreenBackgroundColor" value="#001833" />
    
    <platform name="ios"></platform>
    <platform name="android"></platform>
    
</widget>
```

#### Step 3: Commit to Git

```bash
git add package.json config.xml
git commit -m "Setup: add plugin configuration"
git push origin main
```

#### Step 4: In MABS Console

1. Go to OutSystems MABS
2. Ensure app source points to your Git repo
3. Trigger a new build
4. Build should now succeed ✅

## File Structure

After installation:

```
your-cordova-project/
├─ config.xml
├─ package.json              ← NEW
├─ package-lock.json         ← Generated by npm
├─ plugins/
├─ node_modules/             ← Generated by npm install
├─ www/
└─ platforms/
```

## Verify Installation

```bash
# Check if plugin is installed
cordova plugin list
# Expected output:
# cordova-plugin-change-app-info 2.9.12+ "Change App Info"

# Check if dependencies are installed
npm list
# Expected output:
# ├─ sharp@0.33.x (optional)
# └─ jimp@0.22.x (optional, fallback)
```

## Troubleshooting

### Issue: Plugin not found during build

```bash
# Remove old plugin
cordova plugin remove cordova-plugin-change-app-info

# Re-add from GitHub
cordova plugin add https://github.com/vnkhoado/cordova-plugin-change-app-info.git
```

### Issue: Icon not generated

**Solution:** Install sharp or jimp
```bash
npm install sharp
# OR fallback:
npm install jimp
```

### Issue: NPM registry timeout

```bash
# Increase npm timeout
npm config set fetch-timeout 120000
npm config set fetch-retry-mintimeout 20000
npm config set fetch-retry-maxtimeout 120000

# Then retry
npm install
```

### Issue: MABS build still fails

1. Clear build cache in MABS console
2. Ensure `package.json` is committed to Git
3. Verify all files are pushed to repository
4. Check verbose build logs for errors

## Configuration Checklist

- [ ] `package.json` created with sharp dependency
- [ ] `config.xml` has APP_NAME preference
- [ ] `config.xml` has VERSION_NUMBER preference
- [ ] `config.xml` has VERSION_CODE preference
- [ ] `config.xml` has CDN_ICON preference (optional)
- [ ] `config.xml` has SplashScreenBackgroundColor preference (optional)
- [ ] Plugin added: `cordova plugin add https://github.com/vnkhoado/cordova-plugin-change-app-info.git`
- [ ] All changes committed to Git
- [ ] All changes pushed to repository

## What Gets Auto-Installed

On first build, the plugin's auto-install hook will:
- ✅ Check for sharp and jimp
- ✅ Install missing dependencies
- ✅ Display clear status messages
- ✅ Continue build even if optional deps fail

You don't need to manually install dependencies - just add plugin and build!

## Additional Resources

- [README.md](./README.md) - Main documentation
- [TESTING.md](./TESTING.md) - How to test the plugin
- [CHANGELOG.md](./CHANGELOG.md) - Version history
- [CLEANUP_NOTES.md](./CLEANUP_NOTES.md) - Latest refactoring changes

## Questions?

If you encounter issues:
1. Check [CLEANUP_NOTES.md](./CLEANUP_NOTES.md) for recent changes
2. Check existing GitHub issues
3. Create a new issue with:
   - Error message
   - Node version (`node --version`)
   - NPM version (`npm --version`)
   - Cordova version (`cordova --version`)
   - OS (macOS/Linux/Windows)
